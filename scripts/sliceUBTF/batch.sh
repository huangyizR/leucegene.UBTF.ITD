#!/bin/bash
set -euxo pipefail
declare -a SAMPLE=(01H001 01H002 02H003 02H009 02H017 02H025 02H026 02H032 02H033 02H043 02H046 02H053 02H060 02H066 03H016 03H022 03H024 03H028 03H030 03H033 03H036 03H041 03H052 03H060 03H065 03H067 03H070 03H081 03H083 03H090 03H094 03H095 03H109 03H112 03H116 03H119 04H001 04H006 04H017 04H024 04H025 04H030 04H039 04H041 04H048 04H050 04H054 04H055 04H061 04H063 04H068 04H078 04H080 04H091 04H096 04H101 04H103 04H108 04H111 04H112 04H115 04H117 04H118 04H120 04H121 04H123 04H127 04H132 04H133 04H135 04H138 04H140 05H008 05H013 05H022 05H025 05H030 05H031 05H034 05H042 05H050 05H054 05H065 05H066 05H072 05H078 05H090 05H094 05H097 05H099 05H111 05H113 05H118 05H128 05H136 05H143 05H149 05H163 05H179 05H180 05H181 05H184 05H186 05H193 05H195 06H004 06H010 06H011 06H014 06H016 06H019 06H020 06H021 06H026 06H028 06H029 06H035 06H038 06H045 06H048 06H066 06H073 06H074 06H075 06H077 06H088 06H089 06H099 06H103 06H106 06H115 06H117 06H133 06H135 06H143 06H144 06H146 06H151 06H152 07H003 07H005 07H009 07H019 07H020 07H024 07H034 07H038 07H041 07H042 07H043 07H045 07H052 07H055 07H060 07H062 07H063 07H069 07H082 07H089 07H095 07H098 07H099 07H106 07H107 07H112 07H117 07H124 07H125 07H131 07H133 07H134 07H135 07H137 07H144 07H148 07H151 07H152 07H155 07H156 07H158 07H160 08H004 08H011 08H012 08H018 08H021 08H022 08H033 08H034 08H042 08H048 08H049 08H050 08H053 08H054 08H055 08H056 08H062 08H063 08H065 08H072 08H081 08H082 08H085 08H087 08H088 08H089 08H099 08H104 08H108 08H112 08H113 08H118 08H129 08H137 08H138 08H139 09H002 09H005 09H008 09H010 09H013 09H015 09H016 09H018 09H022 09H024 09H026 09H031 09H032 09H035 09H040 09H042 09H043 09H045 09H046 09H048 09H053 09H054 09H057 09H058 09H060 09H062 09H066 09H070 09H073 09H078 09H079 09H083 09H084 09H085 09H088 09H089 09H090 09H092 09H094 09H098 09H102 09H106 09H111 09H113 09H115 09H119 10H001 10H005 10H007 10H008 10H014 10H015 10H017 10H022 10H023 10H026 10H029 10H030 10H031 10H034 10H038 10H040 10H046 10H048 10H051 10H052 10H053 10H055 10H056 10H058 10H059 10H063 10H066 10H068 10H070 10H072 10H078 10H087 10H089 10H092 10H095 10H101 10H106 10H107 10H109 10H110 10H113 10H115 10H119 10H127 10H130 10H136 10H149 10H161 10H166 10H173 10H174 11H002 11H006 11H008 11H009 11H010 11H014 11H017 11H019 11H021 11H022 11H027 11H035 11H043 11H044 11H046 11H058 11H072 11H083 11H095 11H097 11H103 11H104 11H107 11H126 11H127 11H129 11H132 11H135 11H138 11H140 11H142 11H145 11H151 11H157 11H160 11H170 11H175 11H177 11H179 11H183 11H186 11H187 11H192 11H205 11H217 11H231 11H232 11H234 11H240 12H007 12H010 12H012 12H021 12H030 12H033 12H039 12H042 12H044 12H045 12H055 12H056 12H057 12H058 12H067 12H079 12H091 12H096 12H098 12H106 12H116 12H117 12H124 12H138 12H139 12H148 12H149 12H151 12H165 12H166 12H170 12H171 12H172 12H173 12H175 12H176 12H180 12H183 12H195 13H006 13H009 13H018 13H019 13H039 13H046 13H048 13H053 13H056 13H058 13H065 13H066 13H071 13H073 13H078 13H080 13H083 13H100 13H101 13H104 13H107 13H110 13H114 13H120 13H126 13H139 13H140 13H141 13H150 13H158 13H159 13H162 13H169 13H179 13H185 13H186 14H001 14H007 14H012 14H015 14H017 14H018 14H019 14H020 14H023 14H027 14H031 14H038 14H071 14H133)

#bash your_generator.sh
#Submit to the queue
#for i in {0..9}; do; sbatch -p long slurmn.starscript.$i; sleep 1; done

for i in {0..451}; do 
    cat > slurm.slice.UBTF.${SAMPLE[$i]} << EOF
#!/bin/bash

#SBATCH --export=NONE
#SBATCH -J slice.UBTF.${SAMPLE[$i]}
#SBATCH -o /varidata/research/projects/triche/Peter/leucegene/report/slice.UBTF.${SAMPLE[$i]}.o
#SBATCH -e /varidata/research/projects/triche/Peter/leucegene/report/slice.UBTF.${SAMPLE[$i]}.e
#SBATCH --ntasks 1
#SBATCH --time 2:00:00
#SBATCH --mem=150G

BAM_DIR="/varidata/research/projects/triche/Peter/leucegene/BAM/GSE67040_all_temp/slice/genome"
cd \$BAM_DIR
GENOMIC_REGION="/varidata/research/projects/triche/Peter/leucegene/boardScan/detectUBTFbySCreads/ubtf_genomic.bed"

sliced_genomic_DIR="/varidata/research/projects/triche/Peter/leucegene/boardScan/detectUBTFbySCreads/BAM"

# genomic
samtools view -@ 20 --regions-file \$GENOMIC_REGION -o \$sliced_genomic_DIR/leucegene.${SAMPLE[$i]}.RNASeq.genomic.ubtf.bam  -Pbh leucegene.${SAMPLE[$i]}.RNASeq.genomic.sliced.sorted.bam 

samtools sort  -m 3G -@ 20 -o \$sliced_genomic_DIR/leucegene.${SAMPLE[$i]}.RNASeq.genomic.ubtf.sorted.bam \$sliced_genomic_DIR/leucegene.${SAMPLE[$i]}.RNASeq.genomic.ubtf.bam
samtools index -@ 20 \$sliced_genomic_DIR/leucegene.${SAMPLE[$i]}.RNASeq.genomic.ubtf.sorted.bam

EOF
done
